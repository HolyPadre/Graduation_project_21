<!DOCTYPE html>
<html lang="">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>My Event</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">    <!----===== Iconscout CSS ===== -->

    <link rel="stylesheet" href="/Planner/assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="/Planner/pages/customerPage/main.css">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="/Planner/assets/fonts/font-awesome.min.css">
</head>

<body id="page-top" data-bs-spy="scroll" data-bs-target="#mainNav" data-bs-offset="72">
    <nav class="navbar navbar-light navbar-expand-lg fixed-top bg-secondary text-uppercase" id="mainNav">
        <div class="container"><a class="navbar-brand" href="#page-top">My Events</a><button data-bs-toggle="collapse" data-bs-target="#navbarResponsive" class="navbar-toggler text-white bg-primary navbar-toggler-right text-uppercase rounded" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><i class="fa fa-bars"></i></button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item mx-0 mx-lg-1"><a class="nav-link px-0 px-lg-3 rounded" href="\Planner\pages\customerPage\customerDashboard.html">Home</a></li>
                    <li class="nav-item mx-0 mx-lg-1"><a class="nav-link  px-0 px-lg-3 rounded" href="">My Events</a></li>
                    <li class="nav-item mx-0 mx-lg-1"><a class="nav-link  px-0 px-lg-3 rounded" href=""><i class="fas fa-sign-out-alt" onclick="logoutfunction()">Log Out</i></a></li>

                </ul>
            </div>
        </div>
    </nav>
    <header class="text-center text-white  masthead" id="head">
        <div class="container">
            <h3 class="text-dark mb-4">My Events Table</h3>
            <div class="card shadow">
                
                <div class="card-body">
                    <div class="table-responsive table mt-2" id="dataTable" role="grid" aria-describedby="dataTable_info">
                        <table class="table table-striped" id="dataTable">
                            <thead>
                                <tr>
                                    <th>Event Name</th>
                                    <th>Date</th>
                                    <th>Location</th>
                                    <th>Handle</th>
                                </tr>
                            </thead>
                            <tbody id="eventtable">
                                <!-- <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td>
                                        <button type="button" class="btn btn-primary">Contract</button>
                                        <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#exampleModal1">Payment</button>
                                    </td>                            
                                </tr> -->
                            </tbody>
                           
                        </table>
                    </div>
                </div>
            </div>
        </div>
        </div>
    </header>

     <!-- Modal -->
 <div class="modal fade" id="exampleModal1" tabindex="-1" aria-labelledby="exampleModalLabel1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title" id="exampleModalLabel" style="font-weight: 900; color: black;">Payment</h3>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <div class="container">
                <div class="row">
                  <form class="row g-3">
                    <div class="col-md-6">
                      <label for="inputType" class="form-label">Account Type *</label>
                      <select class="form-select" aria-label="Default" id="selectaccount">
                        <option value="1">Credit Card</option>
                        <option value="2">Bank Transfer</option>
                      </select>
                    </div>
                    <div class="col-md-6" id="banknamemain">
                        <label for="inputName4" class="form-label">Bank Name *</label>
                        <input type="text" class="form-control" id="inputName4">
                      </div>
                      <div class="col-md-6" id="bankaccountmain">
                        <label for="inputName4" class="form-label">Bank Account *</label>
                        <input type="text" class="form-control" id="inputName5">
                      </div>
                  </form>
               </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary"  onclick="done()">Done</button>
        </div>
      </div>
    </div>
  </div>
</div>
  

<footer class="text-center footer">
  <div class="container">
      <div class="row">
          <div class="col-md-4 mb-5 mb-lg-0">
              <h4 class="text-uppercase mb-4">Location</h4>
              <p>2215 Palestine Ramallah<br>Birzeit, MO 65243</p>
          </div>
          <div class="col-md-4 mb-5 mb-lg-0">
              <h4 class="text-uppercase">Find Us On</h4>
              <ul class="list-inline">
                  <li class="list-inline-item"><a class="btn btn-outline-light text-center btn-social rounded-circle" role="button" href="#"><i class="fa fa-facebook fa-fw"></i></a></li>
                  <li class="list-inline-item"><a class="btn btn-outline-light text-center btn-social rounded-circle" role="button" href="#"><i class="fa fa-linkedin fa-fw"></i></a></li>
                  <li class="list-inline-item"><a class="btn btn-outline-light text-center btn-social rounded-circle" role="button" href="#"><i class="fa fa-twitter fa-fw"></i></a></li>
                  <li class="list-inline-item"><a class="btn btn-outline-light text-center btn-social rounded-circle" role="button" href="#"><i class="fa fa-github fa-fw"></i></a></li>
              </ul>
          </div>
          <div class="col-md-4">
              <h4 class="text-uppercase mb-4">About Planner</h4>
              <p class="lead mb-0"><span>Planner created by pairing together our passion for business and events.&nbsp;</span></p>
          </div>
      </div>
  </div>
</footer>
<div class="text-center text-white copyright py-4">
  <div class="container"><small>Copyright Â©&nbsp;Planner 2022</small></div>
</div>
<script src="/Planner/assets/bootstrap/js/bootstrap.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>


</body>
<script>
    function getCookie(name) {
    var nameEQ = name + "=";
    var ca = document.cookie.split(';');
    for(var i=0;i < ca.length;i++) {
        var c = ca[i];
        while (c.charAt(0)==' ') c = c.substring(1,c.length);
        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
        }
    return null;
    }
  </script>
<script>
    window.onload = (event) => {
        if(getCookie("token_user") != "")
        {
        $.ajax({
                url: "http://127.0.0.1:8086/api/customer/dashboard",
                type: 'GET',
                headers: {"Authorization":"Token "+getCookie("token_user")},
                success: function (data) {
                  setCookie("user_id",data.id,5);
            },
            error: function (data) {
            }
                });
  
                $.ajax({
                url: "http://127.0.0.1:8086/api/vendor/dashboard",
                type: 'GET',
                headers: {"Authorization":"Token "+getCookie("token_user")},
                success: function (data) {
                    window.location.replace("../vendorPage/vendorDashboard.html?username="+$("#username").val());
            },
            error: function (data) {
            }
                });
                $.ajax({
                url: "http://127.0.0.1:8086/api/manager/dashboard",
                type: 'GET',
                headers: {"Authorization":"Token "+getCookie("token_user")},
                success: function (data) {
                    window.location.replace("../adminPage/adminDashboard.html?username="+$("#username").val())
            },
            error: function (data) {
            }
                });
            }
            else{
                window.location.replace("/Planner/pages/loginRegisterPages/login.html");
            }

            $.ajax({
                  url: "http://127.0.0.1:8086/item/requests", 
                  type: "GET",          
                  cache: true, 
                  success: function(response){
                      $.each(response, function (key, value) { 
                            if((value.event.user.id == getCookie("user_id"))&& value.status == "approve")
                            {  setCookie("event_id"+value.id,value.event.id,5)
                                $("#eventtable").append("<tr>\
                                      <td>"+value.event.name+"</td>\
                                      <td>"+value.reserved_date.split("T")[0]+"  Time  "+value.time.start_time+"  -  "+value.time.end_date+" </td>\
                                      <td>"+value.event.location+"</td>\
                                      <td>\
                                      <button type='button' class='btn btn-primary'>Contract</button>\
                                      <button type='button' class='btn btn-secondary' data-bs-toggle='modal' data-bs-target='#exampleModal1' id ='"+value.id+"request' onclick = 'takeid(this.id)'>Payment</button>\
                                      </td>\
                                      </tr>");
                            }
                      })
                  }
                })

            
  
  };
  </script>
<script>
function takeid(buttonid){
    setCookie("requestid",""+buttonid.split("request")[0],5);
    alert(getCookie("event_id"+getCookie("requestid")))


}
</script>
<script>
    function done(){
        sel = document.getElementById("selectaccount")
        var selectaccount = sel.options[sel.selectedIndex].text;
        if ($('#validation').length > 0) {
            var row = document.getElementById("validation");
            row.parentNode.removeChild(row);
        }

        var patt =/^(?:(4[0-9]{12}(?:[0-9]{3})?)|(5[1-5][0-9]{14})|(6(?:011|5[0-9]{2})[0-9]{12})|(3[47][0-9]{13})|(3(?:0[0-5]|[68][0-9])[0-9]{11})|((?:2131|1800|35[0-9]{3})[0-9]{11}))$/;
        var text = document.getElementById("inputName5").value
        if(document.getElementById("inputName4").value =="")
        {
            $("#banknamemain").append('<p style="color:red" id="validation">Please Enter a Bank Name</p>');
            return;
        }
        if(!patt.test(text))
        {   
            $("#bankaccountmain").append('<p style="color:red" id="validation">Please Enter a Valid Bank Account.</p>');
            return;
        }
        $.ajax({
                url: 'http://127.0.0.1:8086/api/payment/'+getCookie("user_id"),
                method: 'PUT',
                dataType: 'json',
                data: {
                    "account_type": selectaccount,
                    "bank_number": text,
                    "bank_name": document.getElementById("inputName4").value,
            },
            success: function(data) {
                window.location.replace("/Planner/pages/customerPage/guestManage.html")
            }
            })

    }
    </script>

<script>
    function setCookie(name,value,days) {
    var expires = "";
    if (days) {
        var date = new Date();
        date.setTime(date.getTime() + (days*24*60*60*1000));
        expires = "; expires=" + date.toUTCString();
        }
    document.cookie = name + "=" + (value || "")  + expires + "; path=/";
    }
  </script>
  <script>
    function logoutfunction(){
    setCookie("token_user","",1);
    setCookie("eventname",null,0)
    setCookie("datetext",null,0)
    setCookie("typename",null,0)
    setCookie("locationname",null,0)
    setCookie("typeindex",null,0)
    setCookie("locationIndex",null,0)
    window.location.replace("/Planner/pages/loginRegisterPages/login.html");
    }
  
  </script>
</html>